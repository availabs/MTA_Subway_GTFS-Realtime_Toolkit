<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Wrapper.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Wrapper.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 *
 * @module "MTA_Subway_GTFS-Realtime_Toolkit.Wrapper"
 *
 */

'use strict';


var _            = require('lodash'),
    SuperWrapper = require('GTFS-Realtime_Toolkit').Wrapper,
    indexers     = require('./Indexers');




//========================= The Constructor and prototype ========================= 

/**
 * Creates a GTFS-Realtime Message Wrapper.
 *
 * @constructor
 * @augments 'GTFS-Realtime Wrapper'
 *
 * @param {Object} GTFSrt_JSON - The MTA Subway GTFS-Realtime message, in JSON format.
 */
function Wrapper (GTFSrt_JSON) {
    SuperWrapper.call(this, GTFSrt_JSON);

    this.tripIDToTrainIDMap  = indexers.buildTripToTrainMap(this.tripsIndex);
    this.trainIDToTripKeyMap = indexers.buildTrainToTripMap(this.tripIDToTrainIDMap);
}


Wrapper.prototype = Object.create(SuperWrapper.prototype);


//=================================================================================





//======================== Adding methods to the prototype ======================== 

/** 
 * Get all trains in the message. 
 */
Wrapper.prototype.getAllMonitoredTrains = function () {
    return _.keys(this.trainIDToTripKeyMap);
};




/** 
 * Get the Effective date of the base schedule.
 *  ??? Not necessarily the start_date ???
 *
 *  "It should be noted that the service associated with 
 *      a single day's subway schedule is not necessarily confined to a twenty-four hour period."
 *
 * @param   {String} trip_id - GTFS-Realtime trip_id
 *
 * @returns {Date}
 */
Wrapper.prototype.getTripScheduleDateForTripID = function (trip_id) {
    var startDate  = this.getStartDateForTrip(trip_id)  ,  // In the GTFS-Realtime Wrapper API.
        originTime = this.getOriginTimeForTrip(trip_id) ,
    
        scheduleDate  = new Date(startDate);

    if      ( originTime &lt; 0 )      { scheduleDate.setDate(scheduleDate.getDate() + 1); }
    else if ( originTime > 144000 ) { scheduleDate.setDate(scheduleDate.getDate() - 1); }

    return scheduleDate;
};



/** 
 * From the GTFS-Realtime trip_id, get the string that may be a partial match with the GTFS trip_id.
 *  Note, this partial match is called the tripKey.  
 *  The GTFS indexers take a configuraion option that transforms the 
 *  GTFS tripIDs into this potential partial match key.
 *
 *  @param   {String} trip_id - GTFS-Realtime trip_id
 *  @returns {String} 
 */
Wrapper.prototype.getGTFSTripKeyForRealtimeTripID = function (trip_id) {
    var tripDate     = this.getTripScheduleDateForTripID(trip_id),
        day          = tripDate.getDay(),
        serviceCode;

    if      (day === 0) { serviceCode = 'SUN'; } 
    else if (day === 6) { serviceCode = 'SAT'; }
    else                { serviceCode = 'WKD'; }

    return serviceCode + '_' + trip_id;
};


/**
 * Get the orign time from the trip, as encoded in the train_id.
 *
 * @param {String} trip_id - GTFS-Realtime trip_id
 *
 * @returns {Number}
 */
Wrapper.prototype.getOriginTimeForTrip = function (trip_id) {
    var trainID = this.tripIDToTrainIDMap(trip_id);

    return parseInt(trainID.substring(0, trainID.indexOf('_'))); // FIXME FIXME FIXME
};

//=================================================================================



module.exports = Wrapper;


</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-_MTA_Subway_GTFS-Realtime_Toolkit.Wrapper_.html">"MTA_Subway_GTFS-Realtime_Toolkit.Wrapper"</a></li></ul><h3>Classes</h3><ul><li><a href="module-_MTA_Subway_GTFS-Realtime_Toolkit.Wrapper_-Wrapper.html">Wrapper</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Tue Aug 25 2015 22:35:24 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
